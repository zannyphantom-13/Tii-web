<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Programming â€” The Informatics Initiative</title>
    <link rel="stylesheet" href="/Tii/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <header>
        <a href="/Tii/index.html"><div class="logo-container"><h1>THE INFORMATICS INITIATIVE</h1></div></a>
        <nav class="main-nav">
            <a href="/Tii/curriculum.html">Curriculum</a>
            <a href="/Tii/lessons.html">Weekly Lessons</a>
            <a href="/Tii/portal.html">Student Portal</a>
            <a href="/Tii/feedback.html">Feedback</a>
        </nav>
        <a id="auth-button" href="/Tii/login.html" class="login-btn">Login</a>
    </header>

    <main>
        <h2>Programming</h2>
        <p id="course-description">Foundational and applied programming for informatics.</p>
        <div id="course-actions"></div>
        <div id="lessons">Loading lessons...</div>
    </main>

    <footer><p>&copy; 2024 The Informatics Initiative</p></footer>

    <script>
    (async function(){
        const COURSE_ID = 'programming';
        const apiBase = window.location.origin || 'http://localhost:3000';
        const rl = document.getElementById('lessons');
        try{
            const res = await fetch(`${apiBase}/api/courses/${COURSE_ID}/lessons`);
            if(!res.ok) return rl.innerHTML = '<p>Failed to load lessons.</p>';
            const data = await res.json();
            const list = data.lessons || data;
            if(!list || !list.length) return rl.innerHTML = '<p>No lessons yet.</p>';
            rl.innerHTML = '';
            list.forEach(ls => {
                const card = document.createElement('div');
                card.className = 'lesson-card';
                card.innerHTML = `<h3>${ls.title}</h3><div>${ls.content||''}</div>`;
                rl.appendChild(card);
            });
        }catch(e){ rl.innerHTML = '<p>Error loading lessons.</p>'; console.error(e) }

        const token = localStorage.getItem('authToken');
        if(token) document.getElementById('course-actions').innerHTML = `<a class="btn" href="/Tii/upload-lesson.html?course=${COURSE_ID}">Add Lesson</a>`;
    })();
    </script>
    <script type="module">
        import { handleAuthButton, updatePortalLink } from '/Tii/auth.js';
        updatePortalLink(); handleAuthButton();
    </script>
</body>
</html>
