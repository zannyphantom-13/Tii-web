<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Bioinformatics — The Informatics Initiative</title>
    <link rel="stylesheet" href="/Tii/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <header>
        <a href="/Tii/index.html"><div class="logo-container"><h1>THE INFORMATICS INITIATIVE</h1></div></a>
        <nav class="main-nav">
            <a href="/Tii/curriculum.html">Curriculum</a>
            <a href="/Tii/lessons.html">Weekly Lessons</a>
            <a href="/Tii/portal.html">Student Portal</a>
            <a href="/Tii/feedback.html">Feedback</a>
        </nav>
        <a id="auth-button" href="/Tii/login.html" class="login-btn">Login</a>
    </header>

    <main>
        <div class="course-hero">
            <h1>Bioinformatics</h1>
            <div class="course-meta">Curriculum • Public</div>
            <div class="course-body" id="course-description">Explore computational analysis of biological data.</div>
            <div id="course-actions" style="margin-top:12px;"></div>
            <div id="lessons" class="lesson-list">Loading lessons...</div>
        </div>
    </main>

    <footer><p>&copy; 2024 The Informatics Initiative</p></footer>

    <script>
    (async function(){
        const COURSE_ID = 'bioinformatics';
        const apiBase = window.location.origin || 'http://localhost:3000';
        const rl = document.getElementById('lessons');

        try{
                const res = await fetch(`${apiBase}/api/courses/${COURSE_ID}/lessons`);
                if(!res.ok) return rl.innerHTML = '<p>Failed to load lessons.</p>';
                const data = await res.json();
                if(!data || (!data.lessons || !data.lessons.length)) return rl.innerHTML = '<p>No lessons yet.</p>';
                const list = data.lessons || [];
                rl.innerHTML = '';
                list.forEach(ls => {
                    const card = document.createElement('div'); card.className = 'lesson-card';
                    const summaryBtn = document.createElement('button'); summaryBtn.type='button'; summaryBtn.className='lesson-summary-btn btn'; summaryBtn.setAttribute('aria-expanded','false'); summaryBtn.textContent = ls.title || 'Untitled';
                    const meta = document.createElement('div'); meta.className='lesson-meta'; meta.textContent = [(ls.topic?('Topic: '+ls.topic):''),(ls.weeks?('Weeks: '+ls.weeks):''),(ls.date?('Date: '+ls.date):'')].filter(Boolean).join(' | ');
                    const preview = document.createElement('div'); preview.className='lesson-preview'; preview.style.color='#666'; preview.style.marginTop='8px'; preview.textContent = ls.other_info || (ls.content? (ls.content.length>140?ls.content.slice(0,140)+'...':ls.content): '');
                    const details = document.createElement('div'); details.className='lesson-details'; details.style.display='none';
                    if(ls.image_url){ const img=document.createElement('img'); img.src=ls.image_url; img.style.maxWidth='280px'; details.appendChild(img); }
                    const fc = document.createElement('div'); fc.style.marginTop='8px'; fc.innerHTML=(ls.content||'').replace(/\n/g,'<br/>'); details.appendChild(fc);
                    summaryBtn.addEventListener('click', ()=>{ const expanded = summaryBtn.getAttribute('aria-expanded')==='true'; summaryBtn.setAttribute('aria-expanded', String(!expanded)); details.style.display = expanded ? 'none' : 'block'; });
                    card.appendChild(summaryBtn); card.appendChild(meta); card.appendChild(preview); card.appendChild(details); rl.appendChild(card);
                });
        }catch(e){ rl.innerHTML = '<p>Error loading lessons.</p>'; console.error(e) }

        // Hide inline admin controls on public course pages. Admins should use the admin portal.
        // If you want quick links for admins, use the admin portal instead.
    })();
    </script>
    <script type="module">
        import { handleAuthButton, updatePortalLink } from '/Tii/auth.js';
        updatePortalLink(); handleAuthButton();
    </script>
</body>
</html>
