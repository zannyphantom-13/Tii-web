<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Generated Course (Test) — The Informatics Initiative</title>
  <link rel="stylesheet" href="/Tii/styles.css">
  <style>
    body { background: #f7fafc; padding: 0; }
    .course-hero { max-width: 900px; margin: 32px auto 0 auto; background: #fff; padding: 32px 28px 24px 28px; border-radius: 12px; box-shadow: 0 6px 24px rgba(0,0,0,0.07); }
    .course-meta { color: #2a6e62; margin-bottom: 18px; font-size: 1.1em; }
    .course-body { color: #444; margin-bottom: 18px; font-size: 1.15em; }
    .lesson-list { margin-top: 18px; display: flex; flex-direction: column; gap: 18px; }
    .lesson-card { background: #f9fffa; border: 1px solid #e6f4ef; border-radius: 8px; padding: 18px 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.03); }
    .lesson-title { font-size: 1.2em; color: #2a6e62; margin-bottom: 6px; }
    .lesson-meta { color: #666; font-size: 0.98em; margin-bottom: 8px; }
    .lesson-img { max-width: 320px; border-radius: 6px; border: 1px solid #eee; margin-top: 8px; }
    .lesson-resource { margin-top: 8px; display: inline-block; }
    .lesson-other { margin-top: 8px; color: #666; font-style: italic; }
  </style>
</head>
<body>
  <a href="/Tii/index.html" style="margin-left:32px;display:inline-block;margin-top:18px;color:#2a6e62">← Back to Home</a>
  <main>
    <div class="course-hero">
      <h1 style="font-size:2.2em;color:#2a6e62;margin-bottom:8px;">Generated Course (Test)</h1>
      <div class="course-meta">Curriculum • Added by local-test on 11/18/2025, 1:00:00 PM</div>
      <div class="course-body">A generated test course created to verify server-side page generation and lesson rendering.</div>
      <div class="lesson-list" id="lesson-list">
        <p style="color:#666">Loading lessons…</p>
      </div>
      <div style="margin-top:24px;"><a class="explore-btn-secondary" href="/Tii/other-courses.html">Back to courses</a></div>
    </div>
  </main>
  <script>
    (async function(){
      const courseId = 'c_generated_test';
      const listEl = document.getElementById('lesson-list');
      try {
        const resp = await fetch('/api/courses/' + courseId + '/lessons');
        if (!resp.ok) { listEl.innerHTML = '<p style="color:#c0392b">Failed to load lessons.</p>'; return; }
        const data = await resp.json();
        const lessons = data.lessons || [];
        if (!lessons.length) { listEl.innerHTML = '<p style="color:#666">No lessons yet. Admins can upload lessons from the admin portal.</p>'; return; }
        listEl.innerHTML = '';
        lessons.forEach(l => {
          const div = document.createElement('div');
          div.className = 'lesson-card';
          const parts = [];
          parts.push('<div class="lesson-title">' + (l.title || 'Untitled') + '</div>');
          let meta = [];
          if (l.topic) meta.push('<strong>Topic:</strong> ' + l.topic);
          if (l.weeks) meta.push('<strong>Weeks:</strong> ' + l.weeks);
          if (l.date) meta.push('<strong>Date:</strong> ' + l.date);
          if (meta.length) parts.push('<div class="lesson-meta">' + meta.join(' | ') + '</div>');
          if (l.image_url) parts.push('<img class="lesson-img" src="' + l.image_url + '" alt="lesson image"/>');
          if (l.resource_url) parts.push('<a class="lesson-resource explore-btn-secondary" href="' + l.resource_url + '" target="_blank">Open Resource</a>');
          if (l.other_info) parts.push('<div class="lesson-other">' + l.other_info + '</div>');
          if (l.content) parts.push('<div style="margin-top:10px;color:#444">' + (l.content || '').replace(/
/g,'<br/>') + '</div>');
          div.innerHTML = parts.join('');
          listEl.appendChild(div);
        });
        // Show admin controls if token present in localStorage
        try {
          const token = localStorage && localStorage.getItem && localStorage.getItem('authToken');
          if (token) {
            const controls = document.createElement('div');
            controls.style.marginTop = '18px';
            controls.innerHTML = '<a class="explore-btn" href="/Tii/upload-lesson.html?course=' + courseId + '">Add Lesson</a>';
            listEl.parentNode.appendChild(controls);
          }
        } catch(e) {}
      } catch (e) { listEl.innerHTML = '<p style="color:#c0392b">Network error loading lessons.</p>'; }
    })();
  </script>
</body>
</html>